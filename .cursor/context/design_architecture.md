# システムアーキテクチャ詳細設計（design_architecture.md）

## 1. システムアーキテクチャ全体像

シンプルかつ保守性の高いモジュール分割アーキテクチャを採用します。

```
                                [キャラクター設定マネージャ]
                                           ↓
[入力(テキスト/音声)] → [前処理] → [LLM対話エンジン] → [後処理] → [出力(テキスト/音声)]
                |              ↑          ↑           ↓
                |         [長期記憶DB] [知識ベース] [記憶保存]
                ↓              ↑          ↑           ↓
         [音声認識(STT)]        └──────[統合モジュール]─────┘
```

## 2. コンポーネント詳細

### キャラクター設定マネージャ
- **技術選定**: YAML/JSON設定ファイル + データベース
- **役割**: キャラクター設定の管理、切り替え、適用
- **機能**:
  - 設定テンプレート管理
  - 設定バージョン管理
  - キャラクター別記憶分離

### LLM対話エンジン
- **技術選定**: OpenAI API
- **役割**: 設定されたキャラクター性を維持しながら自然な対話を生成
- **最適化**: プロンプトエンジニアリング、コンテキスト圧縮技術
- **拡張性**: プロバイダ抽象化による複数LLM対応

### 長期記憶システム
- **技術選定**: Chroma DB (ベクトルDB)
- **埋め込み**: OpenAI Embeddings API または SentenceTransformers
- **アーキテクチャ**: RAG (Retrieval Augmented Generation) + 階層的記憶管理
- **機能**:
  - 会話履歴の保存と検索
  - 重要情報の抽出と優先度付け
  - コンテキスト検索と関連情報取得

### 音声処理システム
- **STT**: OpenAI Whisper API または自己ホスティング
- **TTS**: VOICEVOX (日本語に最適化)
- **最適化**: ストリーミング処理、部分応答

### 知識ベース
- **構成**: ベクトルデータベースによるドキュメント管理
- **情報源**: エンタメ、ゲーム、音楽（特にYOASOBI）、漫画情報など
- **更新機能**: 定期的な自動更新システム

### 統合モジュール
- **役割**: 各コンポーネント間の連携と調整
- **機能**: イベント管理、エラーハンドリング、状態管理
- **設計**: インターフェース設計によるモジュール間の疎結合化

### インフラ構成 (Google Cloud)
- **コンピュート**: Cloud Run (サーバーレス)
- **データベース**: Cloud Firestore + Chroma DB
- **ストレージ**: Cloud Storage
- **オーケストレーション**: Cloud Workflows 